# Gramine manifest for healthcare ML inference SGX demo

loader.entrypoint = "file:{{ gramine.libos }}"
libos.entrypoint = "/usr/bin/python3"

loader.log_level = "warning"

# Python executable and arguments
loader.argv = [
    "python3", "../infer_healthcare.py", 
    "--input", "../sample_data/patient_input.pkl",
    "--secure"
]

# Environment variables  
loader.env.PYTHONDONTWRITEBYTECODE = "1"
loader.env.PYTHONUNBUFFERED = "1"

# Trust Intel SGX driver
sgx.trusted_files = [
    "file:{{ gramine.libos }}",
    "file:/usr/",
    "file:/lib/",
    "file:../infer_healthcare.py",
    "file:../healthcare_model.pkl", 
    "file:../sample_data/patient_input.pkl",
]

# Allow access to necessary system files
sgx.allowed_files = [
    "file:/etc/hosts",
    "file:/etc/host.conf",
    "file:/etc/gai.conf",
    "file:/etc/resolv.conf",
    "file:/etc/nsswitch.conf",
]

# Memory and threading configuration
sgx.enclave_size = "256M"
sgx.max_threads = 4

# Enable SGX debugging (remove in production)
sgx.debug = true

# File system mounts for model and data
fs.mounts = [
    { path = "/tmp", uri = "file:/tmp" },
    { path = "../healthcare_model.pkl", uri = "file:../healthcare_model.pkl" },
    { path = "../sample_data/patient_input.pkl", uri = "file:../sample_data/patient_input.pkl" },
]